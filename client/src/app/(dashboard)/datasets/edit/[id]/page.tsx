import { Metadata } from "next";

import { Hydrate, dehydrate } from "@tanstack/react-query";

import getQueryClient from "@/lib/react-query/getQueryClient";

import { getGetDatasetsIdQueryOptions } from "@/types/generated/dataset";
import { getGetDatasetValuesQueryOptions } from "@/types/generated/dataset-value";

import EditDatasetForm from "@/containers/datasets/edit";

export const metadata: Metadata = {
  title: "Edit dataset form | Caribbean Climate smart map",
  description: "Generated by create next app",
};

export default async function EditDatasetPage({ params }: { params: { id: number } }) {
  const { id } = params;
  const queryClient = getQueryClient();

  await queryClient.prefetchQuery(
    getGetDatasetsIdQueryOptions(id, {
      populate: "*",
    }),
  );

  await queryClient.prefetchQuery(
    getGetDatasetValuesQueryOptions({
      filters: {
        dataset: id,
      },
      "pagination[pageSize]": 300,
      populate: {
        country: {
          fields: ["name", "iso3"],
        },
        resources: true,
      },
    }),
  );

  const dehydratedState = dehydrate(queryClient);

  return (
    <Hydrate state={dehydratedState}>
      <EditDatasetForm />;
    </Hydrate>
  );
}
